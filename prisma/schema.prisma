generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_DIRECT_URL")
}

model detalle {
  id_detalle         Int             @id @default(autoincrement())
  posicion           String          @db.VarChar(10)
  tipo               Int
  medida_diametro    Int
  longitud_corte     Float           @db.Real
  cantidad_unitaria  Int
  nro_elementos      Int
  cantidad_total     Int
  id_elemento        Int
  progreso           Int             @default(0)
  especificacion     String
  campos_modificados Json            @default("[]")
  elemento           elemento        @relation(fields: [id_elemento], references: [id_elemento], onDelete: Cascade, onUpdate: NoAction, map: "id_elemento")
  diametro           diametro        @relation(fields: [medida_diametro], references: [medida_diametro], onDelete: NoAction, onUpdate: NoAction, map: "medida_diametro")
  detalle_tarea      detalle_tarea[]
}

model diametro {
  medida_diametro Int       @id
  peso_por_metro  Float     @db.Real
  detalle         detalle[]
}

model elemento {
  id_elemento     Int       @id @default(autoincrement())
  nombre_elemento String    @db.VarChar(150)
  nro_planilla    String    @db.VarChar(50)
  progreso        Int       @default(0)
  detalle         detalle[]
  planilla        planilla  @relation(fields: [nro_planilla], references: [nro_planilla], onDelete: Cascade, onUpdate: NoAction, map: "nro_planilla")
}

model planilla {
  nro_planilla                              String     @id @db.VarChar(30)
  obra                                      String     @db.VarChar(30)
  nro_plano                                 String     @db.VarChar(30)
  sector                                    String     @db.VarChar(30)
  encargado_elaborar                        String     @db.VarChar(5)
  encargado_revisar                         String     @db.VarChar(5)
  encargado_aprobar                         String?    @db.VarChar(5)
  fecha                                     DateTime   @db.Date
  revision                                  Int        @default(0)
  item                                      String     @db.VarChar(20)
  progreso                                  Int        @default(0)
  id_usuario                                Int
  rendimiento_global_corte_ayudante         Float      @default(0) @db.Real
  rendimiento_global_corte_trabajador       Float      @default(0) @db.Real
  rendimiento_global_doblado_ayudante       Float      @default(0) @db.Real
  rendimiento_global_doblado_trabajador     Float      @default(0) @db.Real
  rendimiento_global_empaquetado_ayudante   Float      @default(0) @db.Real
  rendimiento_global_empaquetado_trabajador Float      @default(0) @db.Real
  pesos_diametro                            Json       @default("[]")
  peso_total                                Float      @default(0) @db.Real
  elemento                                  elemento[]
  usuario                                   usuario    @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction, map: "id_usuario")
}

model trabajador {
  id_trabajador           Int        @id @default(autoincrement())
  nombre                  String     @unique @db.VarChar(20)
  rendimiento_corte       Float      @default(0) @db.Real
  rendimiento_doblado     Float      @default(0) @db.Real
  rendimiento_empaquetado Float      @default(0) @db.Real
  activo                  Boolean    @default(true)
  registros_ayudante      registro[] @relation("Registros_ayudante")
  registros_principales   registro[] @relation("Registros_principales")
}

model registro {
  id_registro            Int           @id @default(autoincrement())
  id_detalle_tarea       Int
  fecha                  DateTime      @db.Date
  cantidad               Int
  horas_trabajador       Float         @db.Real
  horas_ayudante         Float         @db.Real
  rendimiento_trabajador Float         @db.Real
  rendimiento_ayudante   Float         @db.Real
  id_usuario             Int
  id_ayudante            Int?
  id_trabajador          Int
  detalle_tarea          detalle_tarea @relation(fields: [id_detalle_tarea], references: [id_detalle_tarea], onDelete: Cascade, onUpdate: NoAction, map: "id_detalle_tarea")
  usuario                usuario       @relation(fields: [id_usuario], references: [id_usuario], onDelete: NoAction, onUpdate: NoAction, map: "id_usuario")
  ayudante               trabajador?   @relation("Registros_ayudante", fields: [id_ayudante], references: [id_trabajador])
  trabajador             trabajador    @relation("Registros_principales", fields: [id_trabajador], references: [id_trabajador])
}

model tarea {
  id_tarea      Int             @id @default(autoincrement())
  nombre_tarea  String          @unique @db.VarChar(15)
  detalle_tarea detalle_tarea[]
}

model detalle_tarea {
  id_detalle_tarea   Int        @id @default(autoincrement())
  id_detalle         Int
  id_tarea           Int
  cantidad_acumulada Int        @default(0)
  completado         Boolean    @default(false)
  tarea              tarea      @relation(fields: [id_tarea], references: [id_tarea])
  detalle            detalle    @relation(fields: [id_detalle], references: [id_detalle], onDelete: Cascade, onUpdate: NoAction, map: "id_detalle")
  registro           registro[]

  @@index([id_tarea])
}

model usuario {
  id_usuario Int        @id @default(autoincrement())
  clave      String     @db.VarChar(16)
  rol        String     @db.VarChar(12)
  planilla   planilla[]
  registro   registro[]
}
